# Graduation Requirement Schema Migration

## Changes Made

### Removed Field
- ❌ `generalRequiredMin` - Removed from all files

### Added Fields
- ✅ `earnedMajorCredits` - Credits already earned before using the app (major courses)
- ✅ `earnedGeneralCredits` - Credits already earned before using the app (general courses)

## Files Updated

### 1. Model Layer
**File**: `src/models/GraduationRequirement.ts`
- Updated interface: removed `generalRequiredMin`, added `earnedMajorCredits` and `earnedGeneralCredits`
- Updated schema: replaced `generalRequiredMin` field with the two new fields (default: 0)

### 2. Type Definitions
**File**: `src/types/index.ts`
- Updated `IGraduationRequirement` interface
- Updated `GraduationRequirementInput` interface
- Updated `GraduationProgress` interface: `general` no longer has `requiredMin` sub-requirement
- Only `major` retains the `requiredMin` sub-requirement

### 3. Service Layer
**File**: `src/services/graduationRequirement.service.ts`
- Updated `calculateProgress()`: 
  - Extracts prior earned credits from requirement
  - Adds prior credits to calculated earned values
  - Moved `pct()` helper before `emptyProgress()` for cleaner code
  - Removed `generalReqEarned` calculation
  - Updated return object to add prior credits to earned totals
- Updated `createDefaults()`: uses new fields instead of `generalRequiredMin`
- Updated JSDoc comment to document prior earned credits behavior

### 4. API Layer
**File**: `src/app/api/graduation-requirements/route.ts`
- Updated Zod schema: replaced `generalRequiredMin` with `earnedMajorCredits` and `earnedGeneralCredits`

### 5. Frontend Components
**File**: `src/components/features/RequirementsSummary.tsx`
- Updated form handler type signature
- Updated `initialData` to pass new fields
- Removed `general.requiredMin` fallback and UI display (교양필수 sub-bar removed)
- Already had `earnedMajorCredits` and `earnedGeneralCredits` support

**File**: `src/components/features/RequirementForm.tsx`
- Already had full support for the new fields (no changes needed)

## Verification

✅ TypeScript compilation: PASSED (no errors)
✅ All 4 backend files updated correctly
✅ Frontend components updated
✅ `generalRequiredMin` completely removed from codebase
✅ New fields added with proper validation and defaults

## Progress Calculation Logic

**Before**: 
- Major earned = completed major courses
- General earned = completed general courses

**After**:
- Major earned = completed major courses + `earnedMajorCredits`
- General earned = completed general courses + `earnedGeneralCredits`
- Total earned = all completed courses + `earnedMajorCredits` + `earnedGeneralCredits`

This allows users to account for credits earned before using the app.
